<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FerreterÃ­a Universal</title>
  <link rel="stylesheet" href="./styles.css">
</head>
<body>

  <div class="app">

    <header class="header">
      <img src="logo.png" alt="FerreterÃ­a Universal" class="logo" onerror="this.style.display='none'">
      <div id="statusIcon" class="status offline" title="Estado de red">ğŸŒ</div>
    </header>

    <!-- HOME -->
    <main id="home">
      <h1>Control de Inventario</h1>
      <p class="subtitle">
        Funciona offline. Con internet se actualiza el inventario maestro desde GitHub.
      </p>

      <div class="card">
        <p><strong>Resumen</strong></p>
        <p>Productos cargados: <span id="totalProductos">0</span></p>
        <p>Ãšltima actualizaciÃ³n: <span id="ultimaActualizacion">â€”</span></p>
        <p>Movimientos hoy: <span id="movHoy">0</span></p>
      </div>

      <button id="btnActualizar" onclick="forzarActualizacion()">Actualizar inventario</button>

      <button class="secondary" onclick="abrirCatalogo()">ğŸ“¦ CatÃ¡logo</button>
      <button class="secondary" onclick="abrirEntradas()">â• Entradas</button>
      <button class="secondary" onclick="abrirSalidas()">â– Salidas</button>
      <button class="secondary" onclick="abrirHistorial()">ğŸ“œ Historial</button>

      <button class="export" onclick="exportarExcel()">
        ğŸ“¤ Exportar reporte diario (Excel)
      </button>

      <p class="mini">
        Sugerencia: al final del dÃ­a exporta el Excel y envÃ­alo. TÃº lo cargas en la PC y luego actualizas el inventario maestro.
      </p>
    </main>

    <!-- CATALOGO -->
    <section id="catalogo" class="panel oculto">
      <div class="panelHead">
        <h2>CatÃ¡logo</h2>
        <button class="chipBtn" onclick="cerrarCatalogo()">âœ•</button>
      </div>

      <input type="text" id="buscadorCatalogo" placeholder="Buscar por cÃ³digo o nombre..." oninput="filtrarCatalogo()">
      <div id="listaProductos"></div>

      <button class="secondary" onclick="cerrarCatalogo()">â¬… Volver</button>
    </section>

    <!-- ENTRADAS -->
    <section id="entradas" class="panel oculto">
      <div class="panelHead">
        <h2>Registrar entrada</h2>
        <button class="chipBtn" onclick="cerrarEntradas()">âœ•</button>
      </div>

      <label>CÃ³digo</label>
      <div class="row">
        <input id="entradaCodigo" placeholder="CÃ³digo (Ej: A001)" oninput="autollenarProducto('entrada')">
        <button class="iconBtn" onclick="abrirBuscador('entrada')" title="Buscar">ğŸ”</button>
      </div>

      <label>Producto</label>
      <input id="entradaProducto" placeholder="Se llena automÃ¡ticamente" disabled>

      <label>Cantidad</label>
      <input id="entradaCantidad" type="number" min="1" placeholder="Ej: 10">

      <label>Proveedor</label>
      <input id="entradaProveedor" placeholder="Ej: Proveedor XYZ">

      <label>Factura</label>
      <input id="entradaFactura" placeholder="Ej: FAC-001">

      <label>Fecha</label>
      <input id="entradaFecha" type="date">

      <button onclick="guardarEntrada()">ğŸ’¾ Guardar entrada</button>
      <button class="secondary" onclick="cerrarEntradas()">â¬… Volver</button>
    </section>

    <!-- SALIDAS -->
    <section id="salidas" class="panel oculto">
      <div class="panelHead">
        <h2>Registrar salida</h2>
        <button class="chipBtn" onclick="cerrarSalidas()">âœ•</button>
      </div>

      <label>CÃ³digo</label>
      <div class="row">
        <input id="salidaCodigo" placeholder="CÃ³digo (Ej: A001)" oninput="autollenarProducto('salida')">
        <button class="iconBtn" onclick="abrirBuscador('salida')" title="Buscar">ğŸ”</button>
      </div>

      <label>Producto</label>
      <input id="salidaProducto" placeholder="Se llena automÃ¡ticamente" disabled>

      <label>Cantidad</label>
      <input id="salidaCantidad" type="number" min="1" placeholder="Ej: 2">

      <label>Factura</label>
      <input id="salidaFactura" placeholder="Ej: FAC-123">

      <label>Fecha</label>
      <input id="salidaFecha" type="date">

      <button onclick="guardarSalida()">ğŸ’¾ Guardar salida</button>
      <button class="secondary" onclick="cerrarSalidas()">â¬… Volver</button>
    </section>

    <!-- BUSCADOR (B2) -->
    <section id="buscador" class="panel oculto">
      <div class="panelHead">
        <h2>Buscar producto</h2>
        <button class="chipBtn" onclick="cerrarBuscador()">âœ•</button>
      </div>

      <input type="text" id="buscadorInput" placeholder="Buscar por cÃ³digo o nombre..." oninput="filtrarBuscador()">
      <div id="buscadorLista"></div>

      <button class="secondary" onclick="cerrarBuscador()">â¬… Volver</button>
    </section>

    <!-- HISTORIAL (D) -->
    <section id="historial" class="panel oculto">
      <div class="panelHead">
        <h2>Historial</h2>
        <button class="chipBtn" onclick="cerrarHistorial()">âœ•</button>
      </div>

      <div class="tabs">
        <button class="tab active" id="tabMov" onclick="setHistTab('mov')">Movimientos</button>
        <button class="tab" id="tabEdit" onclick="setHistTab('edit')">Ediciones</button>
        <button class="tab" id="tabDel" onclick="setHistTab('del')">Eliminaciones</button>
      </div>

      <input type="text" id="histSearch" placeholder="Filtrar por cÃ³digo o producto..." oninput="renderHistorial()">

      <div id="histList"></div>

      <button class="secondary" onclick="cerrarHistorial()">â¬… Volver</button>
    </section>

    <!-- MODAL EDITAR MOVIMIENTO -->
<div id="modal" class="modal oculto" role="dialog" aria-modal="true">
      <div class="modalBox">
        <div class="modalHead">
          <h3 id="modalTitle">Editar</h3>
          <button class="chipBtn" onclick="cerrarModal()">âœ•</button>
        </div>

        <input type="hidden" id="editId">
        <input type="hidden" id="editTipo">

        <label>CÃ³digo</label>
        <input id="editCodigo" disabled>

        <label>Producto</label>
        <input id="editProducto" disabled>

        <label>Cantidad</label>
        <input id="editCantidad" type="number" min="1">

        <label>Factura</label>
        <input id="editFactura">

        <div id="editProveedorWrap">
          <label>Proveedor</label>
          <input id="editProveedor">
        </div>

        <label>Fecha</label>
        <input id="editFecha" type="date">

        <button onclick="guardarEdicion()">Guardar cambios</button>
        <button class="secondary" onclick="cerrarModal()">Cancelar</button>
      </div>
    </div>

    <footer>
      FerreterÃ­a Universal Â· v1.0
    </footer>
  </div>

  <!-- SheetJS para exportar Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script src="./script.js"></script>
</body>
</html>
