<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="theme-color" content="#0b2f7a" />
  <title>Ferreter√≠a Universal ¬∑ Inventario</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>

  <div class="phone-frame">
    <div class="header">
      <div class="header-top">
        <div class="brand">
          <img class="brand-logo" src="logo.png" alt="FERRETER√çA UNIVERSAL" />
          <div class="brand-text">
            <div class="brand-title">FERRETER√çA UNIVERSAL</div>
            <div class="brand-sub">Control interno</div>
          </div>
        </div>

        <div class="header-right">
          <div id="roleBadge" class="role-badge hidden"></div>
          <button id="btnLogout" class="logout-btn hidden" type="button" title="Cerrar sesi√≥n" aria-label="Cerrar sesi√≥n">‚éã</button>
          <div id="netIcon" class="net-icon offline" title="Estado de red" aria-label="Estado de red">üì∂</div>
        </div>
      </div>
    </div>

    <div class="container">

      <!-- ==========================
           LOGIN
      =========================== -->
      <div id="loginScreen" class="screen">
        <div class="card hero login-card">
          <h1 class="title">Iniciar sesi√≥n</h1>
          <p class="subtitle">Elige el rol para entrar a la aplicaci√≥n.</p>

          <div class="btn-row">
            <button id="btnLoginOperador" class="btn primary" type="button">Entrar como OPERADOR</button>
            <button id="btnLoginVendedor" class="btn" type="button">Entrar como VENDEDOR</button>
          </div>

          <div class="hint">
            <b>Nota:</b> El PIN se solicita al entrar. <br/>
            Operador: movimientos de inventario ¬∑ Vendedor: cotizaciones/facturas con precios.
          </div>
        </div>
      </div>

      <!-- ==========================
           HOME OPERADOR
      =========================== -->
      <div id="homeScreen" class="screen hidden">
        <div class="card hero">
          <h2 class="title">Panel Operador</h2>
          <p class="subtitle">
            Inventario local con sincronizaci√≥n cuando hay internet.
          </p>

          <div class="stats">
            <div class="stat">
              <div class="k">Versi√≥n</div>
              <div class="v" id="homeVersion">‚Äî</div>
            </div>
            <div class="stat">
              <div class="k">Productos</div>
              <div class="v" id="homeProductos">0</div>
            </div>
            <div class="stat">
              <div class="k">Mov. hoy</div>
              <div class="v" id="homeMovHoy">0</div>
            </div>
          </div>

          <div class="note">
            Conexi√≥n: <b id="homeEstado">OFF</b>
          </div>

          <div class="btn-row">
            <button id="btnSync" class="btn primary" type="button">Actualizar inventario</button>
            <button id="btnExport" class="btn export" type="button">Exportar Excel</button>
          </div>
        </div>

        <div class="card">
          <div class="h2">Bodega activa</div>

          <div class="btn-row bodega-row">
            <button id="btnBodegaPrincipal" class="btn small" type="button">PRINCIPAL</button>
            <button id="btnBodegaAnexo" class="btn small" type="button">ANEXO</button>
          </div>

          <div id="bodegaNote" class="note"></div>
        </div>

        <div class="grid">
          <button id="btnCatalogo" class="tile" type="button">
            <div class="tile-emoji">üì¶</div>
            <div>
              <div class="tile-title">Cat√°logo</div>
              <div class="tile-desc">Buscar productos, ver stock y filtrar por departamento/categor√≠a.</div>
            </div>
          </button>

          <button id="btnEntrada" class="tile" type="button">
            <div class="tile-emoji">‚¨ÜÔ∏è</div>
            <div>
              <div class="tile-title">Entrada</div>
              <div class="tile-desc">Registrar factura de entrada (suma stock).</div>
            </div>
          </button>

          <button id="btnSalida" class="tile" type="button">
            <div class="tile-emoji">‚¨áÔ∏è</div>
            <div>
              <div class="tile-title">Salida</div>
              <div class="tile-desc">Registrar factura de salida (resta stock).</div>
            </div>
          </button>

          <button id="btnTransferencia" class="tile" type="button">
            <div class="tile-emoji">üîÅ</div>
            <div>
              <div class="tile-title">Transferencia</div>
              <div class="tile-desc">Mover stock entre PRINCIPAL y ANEXO.</div>
            </div>
          </button>

          <button id="btnHistorial" class="tile" type="button">
            <div class="tile-emoji">üßæ</div>
            <div>
              <div class="tile-title">Historial</div>
              <div class="tile-desc">Ver, editar y eliminar facturas (con registro de eliminaciones).</div>
            </div>
          </button>
        </div>
      </div>

      <!-- ==========================
           HOME VENDEDOR
      =========================== -->
      <div id="sellerHomeScreen" class="screen hidden">
        <div class="card hero">
          <h2 class="title">Panel Vendedor</h2>
          <p class="subtitle">
            Genera <b>FACTURAS</b> y <b>COTIZACIONES</b> internas con precios desde <code>precios.json</code>.
          </p>

          <div class="stats">
            <div class="stat">
              <div class="k">Productos</div>
              <div class="v" id="sellerProductos">0</div>
            </div>
            <div class="stat">
              <div class="k">C√≥digos con precio</div>
              <div class="v" id="sellerPrecios">0</div>
            </div>
            <div class="stat">
              <div class="k">Docs hoy</div>
              <div class="v" id="sellerDocsHoy">0</div>
            </div>
          </div>

          <div class="note">
            Conexi√≥n: <b id="sellerEstado">OFF</b>
          </div>

          <div class="btn-row">
            <button id="btnSellerNewFactura" class="btn primary" type="button">Nueva FACTURA</button>
            <button id="btnSellerNewCotizacion" class="btn" type="button">Nueva COTIZACI√ìN</button>
          </div>

          <div class="btn-row">
            <button id="btnSellerHist" class="btn" type="button">Historial de documentos</button>
          </div>
        </div>
      </div>

      <!-- ==========================
           VENDEDOR: DOCUMENTO
      =========================== -->
      <div id="sellerDocScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackSellerDoc" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2" id="sellerDocTitle">Factura</div>
          <div style="width:88px;"></div>
        </div>

        <div class="card">
          <div class="seller-type-pills">
            <button id="sellerTypeFactura" class="pill active" type="button">FACTURA</button>
            <button id="sellerTypeCotizacion" class="pill" type="button">COTIZACI√ìN</button>
          </div>

          
<div class="seller-meta-grid" style="margin-top:10px;">
            <div>
              <label class="label">Fecha</label>
              <input id="sellerFecha" class="input" type="date" />
            </div>

            <div>
              <label class="label">Documento No.</label>
              <input id="sellerDocNo" class="input" type="text" placeholder="FAC-..." />
            </div>

            <div>
              <label class="label">Cliente No.</label>
              <input id="sellerClienteNo" class="input" type="text" placeholder="Opcional" />
            </div>

            <div>
              <label class="label">Nombre del cliente</label>
              <input id="sellerCliente" class="input" type="text" placeholder="Nombre del cliente" />
            </div>

            <div>
              <label class="label">RTN</label>
              <input id="sellerClienteRTN" class="input" type="text" placeholder="Opcional" />
            </div>

            <div>
              <label class="label">Tel√©fono</label>
              <input id="sellerTelefono" class="input" type="tel" placeholder="Opcional" />
            </div>

            <div class="full">
              <label class="label">Direcci√≥n</label>
              <textarea id="sellerClienteDireccion" class="input" rows="2" placeholder="Opcional"></textarea>
            </div>

            <div>
              <label class="label">Tipo de precio</label>
              <select id="sellerPrecioTipo" class="input">
                <option value="precio">Precio</option>
                <option value="precioA">Precio A</option>
                <option value="precioB">Precio B</option>
                <option value="precioC">Precio C</option>
                <option value="mayoreo">Mayoreo</option>
              </select>
            </div>

            <div>
              <label class="label">Moneda</label>
              <select id="sellerMoneda" class="input">
                <option value="L" selected>L</option>
              </select>
            </div>
          </div>


        <div class="card" style="margin-top:12px;">
          <div class="h2">Agregar producto</div>

          <label class="label">C√≥digo</label>
          <div class="input-row">
            <input id="sellerCodigo" class="input" type="text" placeholder="Ej: 12-345 o 12345" />
            <button id="btnBuscarSeller" class="icon-btn" type="button" title="Buscar producto">üîé</button>
          </div>
          <div id="sellerAutoList" class="autocomplete-list"></div>

          <label class="label">Producto</label>
          <input id="sellerProducto" class="input" type="text" disabled />

          <div class="input-row" style="margin-top:10px;">
            <div style="flex:1;">
              <label class="label">Cantidad</label>
              <input id="sellerCantidad" class="input" type="number" min="1" placeholder="0" />
            </div>
            <div style="flex:1;">
              <label class="label">Precio unitario</label>
              <input id="sellerPrecioUnit" class="input" type="number" min="0" step="0.01" placeholder="0.00" />
            </div>
          </div>

          <div id="sellerPrecioHint" class="note"></div>

          <div class="btn-row">
            <button id="btnAddSellerItem" class="btn primary" type="button">Agregar</button>
            <button id="btnClearSellerItems" class="btn danger" type="button">Vaciar</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px;">
          <div class="h2">Productos en el documento</div>
          <div id="sellerItemsInfo" class="note"></div>

          <div class="table">
            <div id="sellerItemsEditor"></div>
          </div>
        </div>

        <div class="card" style="margin-top:12px;">
          <div class="h2">Vista previa</div>
          <div id="sellerDocPreview"></div>

          <div class="btn-row" style="margin-top:12px;">
            <button id="btnSellerSave" class="btn primary" type="button">Guardar</button>
            <button id="btnSellerExportExcel" class="btn export" type="button">Excel</button>
          </div>
          <div class="btn-row">
            <button id="btnSellerExportPng" class="btn" type="button">Imagen</button>
            <button id="btnSellerExportPdf" class="btn" type="button">PDF</button>
          </div>
        </div>
      </div>
      </div>

      <!-- ==========================
           VENDEDOR: HISTORIAL
      =========================== -->
      <div id="sellerHistScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackSellerHist" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Historial vendedor</div>
          <div style="width:88px;"></div>
        </div>

        <div class="card">
          <label class="label">Buscar</label>
          <input id="sellerHistSearch" class="input" type="text" placeholder="Documento, cliente, tel√©fono, c√≥digo..." />

          <div class="table" style="margin-top:12px;">
            <div id="sellerHistList"></div>
          </div>
        </div>
      </div>

      <!-- ==========================
           CATALOGO
      =========================== -->
      <div id="catalogScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackCatalog" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Cat√°logo</div>
          <button id="btnOpenFilters" class="btn small" type="button">Filtros</button>
        </div>

        <label class="label">Buscar</label>
        <input id="catalogSearch" class="input" type="text" placeholder="C√≥digo o producto..." />

        <div class="btn-row">
          <button id="btnFilterStock" class="btn small" type="button">Solo con stock</button>
          <button id="btnClearFilters" class="btn small" type="button">Limpiar</button>
        </div>

        <div class="chips">
          <div id="chipDep" class="chip hidden">
            <span>DEP:</span>
            <span id="chipDepText"></span>
            <button id="chipDepClear" class="x" type="button">√ó</button>
          </div>

          <div id="chipCat" class="chip hidden">
            <span>CAT:</span>
            <span id="chipCatText"></span>
            <button id="chipCatClear" class="x" type="button">√ó</button>
          </div>
        </div>

        <div class="note" id="catalogInfo"></div>

        <div class="table">
          <div id="catalogList"></div>
        </div>
      </div>

      <!-- ==========================
           ENTRADA
      =========================== -->
      <div id="entradaScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackEntrada" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Entrada</div>
          <div style="width:88px;"></div>
        </div>

        <div class="card">
          <label class="label">Proveedor</label>
          <input id="entradaProveedor" class="input" type="text" placeholder="Nombre del proveedor" />

          <div class="input-row" style="margin-top:10px;">
            <div style="flex:1;">
              <label class="label">Factura No.</label>
              <input id="entradaFactura" class="input" type="text" placeholder="Ej: F-123" />
            </div>
            <div style="flex:1;">
              <label class="label">Fecha</label>
              <input id="entradaFecha" class="input" type="date" />
            </div>
          </div>

          <label class="label">C√≥digo</label>
          <div class="input-row">
            <input id="entradaCodigo" class="input" type="text" placeholder="Ej: 12-345" />
            <button id="btnBuscarEntrada" class="icon-btn" type="button" title="Buscar producto">üîé</button>
          </div>
          <div id="entradaAutoList" class="autocomplete-list"></div>

          <label class="label">Producto</label>
          <input id="entradaProducto" class="input" type="text" disabled />

          <label class="label">Cantidad</label>
          <input id="entradaCantidad" class="input" type="number" min="1" placeholder="0" />

          <div class="btn-row">
            <button id="btnAddEntradaItem" class="btn primary" type="button">Agregar</button>
            <button id="btnClearEntradaItems" class="btn danger" type="button">Vaciar</button>
          </div>

          <div id="entradaItemsInfo" class="note"></div>
          <div id="entradaFacturaPreview"></div>

          <div class="btn-row">
            <button id="btnGuardarEntrada" class="btn export" type="button">Guardar factura</button>
          </div>
        </div>
      </div>

      <!-- ==========================
           SALIDA
      =========================== -->
      <div id="salidaScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackSalida" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Salida</div>
          <div style="width:88px;"></div>
        </div>

        <div class="card">
          <div class="input-row">
            <div style="flex:1;">
              <label class="label">Factura No.</label>
              <input id="salidaFactura" class="input" type="text" placeholder="Ej: S-456" />
            </div>
            <div style="flex:1;">
              <label class="label">Fecha</label>
              <input id="salidaFecha" class="input" type="date" />
            </div>
          </div>

          <label class="label">C√≥digo</label>
          <div class="input-row">
            <input id="salidaCodigo" class="input" type="text" placeholder="Ej: 12-345" />
            <button id="btnBuscarSalida" class="icon-btn" type="button" title="Buscar producto">üîé</button>
          </div>
          <div id="salidaAutoList" class="autocomplete-list"></div>

          <label class="label">Producto</label>
          <input id="salidaProducto" class="input" type="text" disabled />

          <label class="label">Cantidad</label>
          <input id="salidaCantidad" class="input" type="number" min="1" placeholder="0" />

          <div id="salidaStockInfo" class="note"></div>

          <div class="btn-row">
            <button id="btnAddSalidaItem" class="btn primary" type="button">Agregar</button>
            <button id="btnClearSalidaItems" class="btn danger" type="button">Vaciar</button>
          </div>

          <div id="salidaItemsInfo" class="note"></div>
          <div id="salidaFacturaPreview"></div>

          <div class="btn-row">
            <button id="btnGuardarSalida" class="btn export" type="button">Guardar factura</button>
          </div>
        </div>
      </div>

      <!-- ==========================
           TRANSFERENCIA
      =========================== -->
      <div id="transferScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackTransfer" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Transferencia</div>
          <div style="width:88px;"></div>
        </div>

        <div class="card">
          <div class="input-row">
            <div style="flex:1;">
              <label class="label">Referencia</label>
              <input id="transferReferencia" class="input" type="text" placeholder="Opcional" />
            </div>
            <div style="flex:1;">
              <label class="label">Fecha</label>
              <input id="transferFecha" class="input" type="date" />
            </div>
          </div>

          <div id="transferBodegasInfo" class="note"></div>

          <label class="label">C√≥digo</label>
          <div class="input-row">
            <input id="transferCodigo" class="input" type="text" placeholder="Ej: 12-345" />
            <button id="btnBuscarTransfer" class="icon-btn" type="button" title="Buscar producto">üîé</button>
          </div>
          <div id="transferAutoList" class="autocomplete-list"></div>

          <label class="label">Producto</label>
          <input id="transferProducto" class="input" type="text" disabled />

          <label class="label">Cantidad</label>
          <input id="transferCantidad" class="input" type="number" min="1" placeholder="0" />

          <div id="transferStockInfo" class="note"></div>

          <div class="btn-row">
            <button id="btnAddTransferItem" class="btn primary" type="button">Agregar</button>
            <button id="btnClearTransferItems" class="btn danger" type="button">Vaciar</button>
          </div>

          <div id="transferItemsInfo" class="note"></div>
          <div id="transferFacturaPreview"></div>

          <div class="btn-row">
            <button id="btnGuardarTransferencia" class="btn export" type="button">Guardar transferencia</button>
          </div>
        </div>
      </div>

      <!-- ==========================
           SEARCH (LUPA)
      =========================== -->
      <div id="searchScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackSearch" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Buscar producto</div>
          <div style="width:88px;"></div>
        </div>

        <label class="label">Buscar</label>
        <input id="searchInput" class="input" type="text" placeholder="C√≥digo o nombre..." />

        <div id="searchInfo" class="note"></div>

        <div class="table">
          <div id="searchList"></div>
        </div>
      </div>

      <!-- ==========================
           HISTORIAL (OPERADOR)
      =========================== -->
      <div id="historialScreen" class="screen hidden">
        <div class="screen-head">
          <button id="btnBackHistorial" class="btn small" type="button">‚Üê Atr√°s</button>
          <div class="h2">Historial</div>
          <div style="width:88px;"></div>
        </div>

        <label class="label">Buscar</label>
        <input id="histSearch" class="input" type="text" placeholder="Factura, proveedor, fecha, c√≥digo..." />

        <div class="tabs">
          <div id="tabMov" class="tab active">Facturas</div>
          <div id="tabTrf" class="tab">Transferencias</div>
          <div id="tabDel" class="tab">Eliminaciones</div>
        </div>

        <div id="histHeadDel" class="note hidden">
          Aqu√≠ se muestran eliminaciones (art√≠culos o facturas) con su detalle.
        </div>

        <div class="table">
          <div id="histList"></div>
        </div>
      </div>

    </div>

    <div class="footer">
      ¬© Ferreter√≠a Universal ¬∑ App interna
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <!-- PIN OVERLAY -->
  <div id="pinOverlay" class="overlay hidden">
    <div class="modal">
      <h3 class="modal-title">PIN requerido</h3>
      <p id="pinMessage" class="modal-msg">Ingresa el PIN</p>
      <input id="pinInput" class="input" type="password" inputmode="numeric" placeholder="PIN" />
      <div class="modal-actions" style="margin-top:12px;">
        <button id="pinCancel" class="btn small" type="button">Cancelar</button>
        <button id="pinOk" class="btn small primary" type="button">Entrar</button>
      </div>
    </div>
  </div>

  <!-- CONFIRM OVERLAY -->
  <div id="confirmOverlay" class="overlay hidden">
    <div class="modal">
      <h3 class="modal-title">Confirmar</h3>
      <p id="confirmMessage" class="modal-msg">¬øSeguro?</p>
      <div class="modal-actions">
        <button id="confirmCancel" class="btn small" type="button">Cancelar</button>
        <button id="confirmOk" class="btn small danger" type="button">S√≠</button>
      </div>
    </div>
  </div>

  <!-- FILTER OVERLAY -->
  <div id="filterOverlay" class="overlay hidden">
    <div class="modal">
      <h3 class="modal-title">Filtros</h3>
      <p id="filterModalHint" class="modal-msg"></p>

      <label class="label">Buscar (departamento o categor√≠a)</label>
      <input id="filterModalSearch" class="input" type="text" placeholder="Escribe para filtrar..." />

      <div class="filter-cols" style="margin-top:12px;">
        <div>
          <div class="filter-col-title">Departamentos</div>
          <div id="filterDepList" class="filter-list"></div>
        </div>

        <div>
          <div class="filter-col-title">Categor√≠as</div>
          <div id="filterCatList" class="filter-list"></div>
        </div>
      </div>

      <div class="modal-actions" style="margin-top:12px;">
        <button id="btnModalClearFilters" class="btn small" type="button">Limpiar</button>
        <button id="btnCloseFilters" class="btn small" type="button">Cerrar</button>
        <button id="btnModalDone" class="btn small primary" type="button">Listo</button>
      </div>
    </div>
  </div>

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <script src="script.js"></script>
</body>
</html>
